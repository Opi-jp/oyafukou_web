# LINE連携による店長コメント自動更新システム提案

## 🎯 概要
店長がLINEでメッセージを送るだけで、Webサイトの店長コメントが自動更新されるシステム

## 📱 実装方法（3つの選択肢）

### 1. LINE Messaging API + Webhook（推奨）
**仕組み：**
- 各店舗用のLINE公式アカウント（または共通アカウント）を作成
- 店長がLINEでメッセージを送信
- WebhookでメッセージをWebサイトのAPIが受信
- 自動的にデータベースを更新

**メリット：**
- 無料で実装可能（月1000通まで）
- リアルタイム更新
- 画像も送信可能
- 既読確認で更新成功を確認

**実装手順：**
1. LINE Developersでチャンネル作成
2. Webhook URLを設定（例：`https://oyafukou-web.vercel.app/api/line-webhook`）
3. APIエンドポイントを実装
4. 店長にQRコードを配布

### 2. LINE WORKS（ビジネス向け）
**仕組み：**
- LINE WORKSのグループチャットを作成
- Bot APIを使用してメッセージを取得
- 定期的にメッセージをチェックして更新

**メリット：**
- ビジネス向け機能が充実
- 複数店舗の管理が簡単
- 承認フローを追加可能

**デメリット：**
- 有料（1ユーザー300円/月〜）

### 3. IFTTT/Zapier連携（最も簡単）
**仕組み：**
- IFTTTまたはZapierを使用
- LINE → Googleスプレッドシート → Webhook
- ノーコードで実装可能

**メリット：**
- プログラミング不要
- 設定が簡単

**デメリット：**
- 月額料金が発生する可能性

## 💬 使用イメージ

### 店長側の操作
```
1. 専用LINEアカウントを友だち追加
2. メッセージを送信：
   「今日のおすすめは新鮮なマグロです！脂がのってて最高です😊」
3. 画像も一緒に送信可能
4. 「更新しました✅」と返信が来る
```

### システムの動作
```
1. メッセージを受信
2. 店舗を識別（LINEユーザーIDから）
3. データベースのmanagerCommentを更新
4. 画像があればVercel Blobにアップロード
5. 確認メッセージを返信
```

## 🛠 必要な実装

### 1. APIエンドポイント（/api/line-webhook）
```typescript
export async function POST(request: Request) {
  const body = await request.json();
  
  // LINE署名の検証
  // メッセージの取得
  // 店舗の識別
  // データベース更新
  // 返信メッセージ送信
}
```

### 2. 店長管理テーブル
```typescript
{
  lineUserId: string;      // LINEユーザーID
  storeId: string;         // 店舗ID
  managerName: string;     // 店長名
  isActive: boolean;       // 有効/無効
}
```

### 3. セキュリティ機能
- LINE署名検証（なりすまし防止）
- 登録済み店長のみ更新可能
- 不適切な内容のフィルタリング

## 📊 追加機能の可能性

### 1. コマンド機能
```
「営業時間 19:00-3:00」→ 営業時間を更新
「臨時休業 設備点検のため」→ 臨時休業設定
「メニュー追加 ビール 500円」→ メニュー追加
```

### 2. 定期レポート
- 毎日の来客数（アクセス数）を通知
- 人気メニューランキング
- 予約状況の確認

### 3. 複数スタッフ対応
- 副店長もコメント更新可能
- 承認フロー（店長が承認後に公開）

## 💰 コスト見積もり（2025年最新）

### LINE公式アカウント料金プラン

#### コミュニケーションプラン（無料）
- **月額料金**: 0円
- **無料メッセージ**: 月200通まで
- **追加メッセージ**: 利用不可
- **店長コメント更新には十分**: 1日6-7回更新可能

#### ライトプラン（月額5,000円）
- **無料メッセージ**: 月5,000通
- **追加メッセージ**: 利用不可
- **複数店舗対応可能**: 10店舗でも1日16回/店舗

#### スタンダードプラン（月額15,000円）
- **無料メッセージ**: 月30,000通
- **追加メッセージ**: 従量課金制で利用可能
- **大規模運用向け**

### 重要な注意点
- **2023年6月の改定**: 無料枠が1,000通→200通に削減
- **リプライメッセージは無料**: 店長への返信は無料（カウント対象外）
- **LINE Notify終了**: 2025年3月31日でサービス終了

### 開発工数
- 基本機能：1-2日
- 追加機能込み：3-5日

### 運用コスト比較
| 用途 | 推奨プラン | 月額費用 |
|------|-----------|----------|
| 1店舗（1日3回更新） | 無料プラン | 0円 |
| 5店舗（1日3回更新） | ライトプラン | 5,000円 |
| 10店舗以上 | スタンダードプラン | 15,000円 |

## 🚀 実装優先順位

1. **フェーズ1（基本機能）**
   - テキストコメントの更新
   - 更新確認の返信

2. **フェーズ2（画像対応）**
   - 画像アップロード
   - 画像の自動リサイズ

3. **フェーズ3（高度な機能）**
   - コマンド機能
   - 複数店舗管理
   - レポート機能

## ⚡ 簡易版の実装案

最初はシンプルに：
1. 各店長にLINE IDを発行
2. 「コメント更新」というキーワードの後にコメントを送信
3. 自動的にWebサイトに反映

この方法なら1日で実装可能です。

---

実装をご希望の場合は、どの方法が良いか教えてください！